{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Recipe Schema",
    "description": "The schema of recipe for Reciper",
    "type": "object",
    "definitions": {
        "recipe_id": {
            "type": "string",
            "description": "Recipe ID format",
            "pattern": "^r#[a-z0-9_]+$",
            "examples": [
                "r#rice"
            ]
        },
        "capacity": {
            "type": "string",
            "pattern": "^[0-9]+(l|ml|g|mg|kg)$",
            "description": "The capacity of kitchenware"
        },
        "kitchenware": {
            "type": "object",
            "properties": {
                "id": {
                    "$ref": "./kitchenware.json#/definitions/kitchenware_id"
                },
                "capacity": {
                    "$ref": "#/definitions/capacity"
                },
                "quantity": {
                    "type": "integer",
                    "minimum": 1,
                    "default": 1
                }
            }
        },
        "material_quantity": {
            "type": "string",
            "pattern": "^m#\\w+(\\s\\d+(g|kg)?)?$",
            "examples": [
                "m#rice 10g",
                "m#egg 2",
                "#water_boiled 10ml",
                "#pork"
            ]
        },
        "material_to_add": {
            "type": "string",
            "pattern": "^m#[a-z0-9_]+(?:@[a-z_]+)?(?:=[a-z_]+)?(?:\\s+\\d+(?:ml|l|kg|g|mg)?)?$",
            "examples": [
                "m#rice",
                "m#rice=cooked 10g",
                "m#beef@sliced 100g",
                "m#beef@sliced=cooked"
            ]
        },
        "material_state": {
            "type": "string",
            "pattern": "^m#[a-z0-9_]+(?:@[a-z_]+)?(?:=[a-z_]+)$"
        },
        "material_for_step": {
            "type": "string",
            "pattern": "^m#[a-z0-9_]+(?:@[a-z_]+)?(?:=[a-z_]+)?$"
        },
        "preprocess_object": {
            "oneOf": [
                {
                    "$ref": "#/definitions/material_quantity"
                },
                {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/material_quantity"
                    },
                    "minItems": 1
                }
            ]
        },
        "duration": {
            "type": "string",
            "pattern": "^\\d+(sec|min|hr)$"
        }
    },
    "properties": {
        "id": {
            "$ref": "#/definitions/recipe_id",
            "description": "The ID of recipe"
        },
        "version": {
            "$ref": "./meta.json#/definitions/version"
        },
        "extend": {
            "$ref": "#/definitions/recipe_id",
            "description": "The parent recipe"
        },
        "kitchenware": {
            "oneOf": [
                {
                    "$ref": "./kitchenware.json#/definitions/kitchenware_id",
                    "description": "The ID of kitchenware"
                },
                {
                    "$ref": "#/definitions/kitchenware"
                },
                {
                    "type": "array",
                    "items": {
                        "oneOf": [
                            {
                                "$ref": "./kitchenware.json#/definitions/kitchenware_id"
                            },
                            {
                                "$ref": "#/definitions/kitchenware"
                            }
                        ]
                    },
                    "minItems": 1,
                    "description": "The list of kitchenware"
                }
            ]
        },
        "preprocess": {
            "type": "array",
            "items": {
                "oneOf": [
                    {
                        "type": "object",
                        "properties": {
                            "slice": {
                                "$ref": "#/definitions/preprocess_object"
                            }
                        },
                        "required": [
                            "slice"
                        ]
                    },
                    {
                        "type": "object",
                        "properties": {
                            "ring_cut": {
                                "$ref": "#/definitions/preprocess_object"
                            }
                        },
                        "required": [
                            "ring_cut"
                        ]
                    },
                    {
                        "type": "object",
                        "properties": {
                            "mince": {
                                "$ref": "#/definitions/preprocess_object"
                            }
                        },
                        "required": [
                            "mince"
                        ]
                    },
                    {
                        "type": "object",
                        "properties": {
                            "julienne": {
                                "$ref": "#/definitions/preprocess_object"
                            }
                        },
                        "required": [
                            "julienne"
                        ]
                    },
                    {
                        "type": "object",
                        "properties": {
                            "whisk": {
                                "$ref": "#/definitions/preprocess_object"
                            },
                            "till": {
                                "type": "string",
                                "enum": [
                                    "smooth"
                                ]
                            }
                        },
                        "required": [
                            "whisk"
                        ]
                    }
                ]
            }
        },
        "steps": {
            "type": "array",
            "items": {
                "oneOf": [
                    {
                        "type": "string",
                        "enum": [
                            "boil"
                        ]
                    },
                    {
                        "type": "object",
                        "properties": {
                            "fire": {
                                "type": "string",
                                "enum": [
                                    "low",
                                    "medium",
                                    "high"
                                ]
                            }
                        },
                        "required": [
                            "fire"
                        ]
                    },
                    {
                        "type": "object",
                        "properties": {
                            "add": {
                                "oneOf": [
                                    {
                                        "$ref": "#/definitions/material_to_add"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/definitions/material_to_add"
                                        }
                                    }
                                ]
                            },
                            "into": {
                                "$ref": "./kitchenware.json#/definitions/kitchenware_id"
                            }
                        },
                        "required": [
                            "add"
                        ]
                    },
                    {
                        "type": "object",
                        "properties": {
                            "heat": {
                                "type": "null",
                                "pattern": "^$"
                            },
                            "till": {
                                "oneOf": [
                                    {
                                        "type": "string",
                                        "pattern": "^\\d+(%)$"
                                    },
                                    {
                                        "$ref": "#/definitions/material_state"
                                    }
                                ]
                            }
                        },
                        "required": [
                            "heat"
                        ]
                    },
                    {
                        "type": "object",
                        "properties": {
                            "fry": {
                                "type": "null"
                            },
                            "till": {
                                "$ref": "#/definitions/material_state"
                            }
                        },
                        "required": [
                            "fry"
                        ]
                    },
                    {
                        "type": "object",
                        "properties": {
                            "dry_fry": {
                                "type": "null"
                            },
                            "till": {
                                "$ref": "#/definitions/material_state"
                            }
                        },
                        "required": [
                            "dry_fry"
                        ]
                    },
                    {
                        "type": "object",
                        "properties": {
                            "take": {
                                "oneOf": [
                                    {
                                        "$ref": "#/definitions/material_for_step"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/definitions/material_for_step"
                                        },
                                        "uniqueItems": true
                                    }
                                ]
                            }
                        },
                        "required": [
                            "take"
                        ]
                    },
                    {
                        "type": "object",
                        "properties": {
                            "blanch": {
                                "type": "null"
                            },
                            "for": {
                                "$ref": "#/definitions/duration"
                            }
                        },
                        "required": [
                            "blanch"
                        ]
                    },
                    {
                        "type": "object",
                        "properties": {
                            "braise": {
                                "type": "null"
                            },
                            "for": {
                                "$ref": "#/definitions/duration"
                            },
                            "till": {
                                "$ref": "#/definitions/material_state"
                            }
                        },
                        "required": [
                            "braise"
                        ]
                    }
                ]
            }
        }
    },
    "required": [
        "id",
        "kitchenware",
        "steps"
    ]
}